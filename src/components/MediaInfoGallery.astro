---
// MediaInfoGallery.astro

import type { CollectionEntry } from 'astro:content';
import { Icon } from 'astro-icon/components';
import { isImage, formatTag, getFormatIcon } from '@/utils/media-info-helpers.ts';

export interface Props {
  mediaEntry: CollectionEntry<'media'>;
}

const { mediaEntry } = Astro.props;

// Tags (for gallery, just format and maybe type, minimal here)
const tagsToRemove: string[] = ['type/notes'];
const otherTags: string[] = [...mediaEntry.data.tags ?? []]
  .map(formatTag)
  .filter(tag => !tagsToRemove.includes(tag));
otherTags.push(mediaEntry.data.format);

const format = Array.isArray(mediaEntry.data.format)
  ? mediaEntry.data.format[0]
  : mediaEntry.data.format;
const formatIcon = getFormatIcon(format);
---

<div class="media-info rounded-xl bg-surface-1 px-4 py-4 w-full flex flex-col lg:flex-row items-stretch gap-2 lg:gap-4">
  <!-- Image -->
  <div class="flex justify-center items-center">
    {mediaEntry.data.link_to_source ? (
      isImage(mediaEntry.data.link_to_source) ?
        (<img
          src={mediaEntry.data.link_to_source}
          alt={`cover for ${mediaEntry.data.title}`}
          class="w-auto my-auto h-32 lg:w-48 lg:object-contain"
        />)
      : (
        <div class="flex flex-wrap justify-center">
          <a
            href={mediaEntry.data.link_to_source}
            target="_blank"
            rel="noopener"
            class="inline-flex items-center justify-center rounded-full focus-outline-rounded"
            aria-label={`source for ${mediaEntry.data.title}`}
          >
            <Icon name={formatIcon} class="h-16 w-auto lg:w-16 lg:h-auto text-content-3 hover:text-content-2 hover:scale-105 soft-transition" />
          </a>
        </div>
      )
    ) : (
      <span class="inline-flex items-center justify-center rounded-full">
        <Icon name={formatIcon} class="h-16 w-auto lg:w-16 lg:h-auto text-surface-4" />
      </span>
    )}
  </div>

  <!-- Info box -->
  <section class="flex flex-col justify-between w-full lg:h-32">
    <div>
      <p class="font-heading text-content-1 italic text-center text-base font-light">
        {mediaEntry.data.title}
      </p>
      <p class="font-base text-content-3 text-center font-light text-sm">
        {mediaEntry.data.author}
      </p>
    </div>

    <a
      href={`/media/${mediaEntry.id}`}
      rel="noopener"
      class="inline-flex items-center justify-center rounded-full focus-outline-rounded"
      aria-label={`source for ${mediaEntry.data.title}`}
    >
      <Icon name="mdi--more-circle-outline" class="w-7 h-7 text-content-4 hover:text-content-2 hover:scale-105 soft-transition" />
    </a>
  </section>
</div>