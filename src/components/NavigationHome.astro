---
import { Icon } from 'astro-icon/components'
import { NAV_ITEMS } from '@/data/navData'

const headerClasses = "font-header text-lg font-semibold tracking-wide text-content-1"
const linkClasses = "block font-header text-base font-light text-content-3 rounded-xl py-1.5 hover:text-content-2 hover:bg-surface-2 hover:font-semibold focus-outline-rounded soft-transition "
const mobileClasses = "block font-header text-base font-light text-content-3 soft-transition hover:font-semibold hover:text-content-2"
---

<aside class={`hidden md:flex flex-col fixed top-0 left-0 h-full md:w-54 lg:w-68 z-50 bg-surface-1 items-center pt-6 pb-8`}>
  {/* Name and logo */}
  <div class="flex flex-row items-center mb-6">
    <img src="/tricolor-paw.svg" alt="paw-logo" class="md:w-10 lg:w-14 mt-2 h-auto mr-2" />
    <span class="font-serif md:text-xl lg:text-3xl font-bold text-content-3 tracking-tight mt-3 mb-1">maya sheth</span>
  </div>

    {/* Search bar */}
    <div class="mb-6 w-5/6 mx-auto">
      <div class="group relative">
        <Icon name="mdi--magnify" class="absolute left-2 top-1/2 h-6 w-6 -translate-y-1/2 text-content-3 soft-transition group-has-[:focus]:text-content-2" />
        <input type="text" placeholder="search!" class="w-full rounded border border-content-3 py-1.5 pl-9 pr-3 font-base text-base font-light text-content-1 focus-border">
      </div>
    </div>

  {/* Navigation (stacked by section) */}
  <nav class="w-full text-center">
    {NAV_ITEMS.map(section => (
      <div class="mb-4">
        <div class={headerClasses}>
          {section.label}
        </div>
        <div class="flex flex-col">
          {section.children.map(link => (
            <a href={link.href} class={linkClasses}>{link.label}</a>
          ))}
        </div>
      </div>
    ))}

  </nav>

</aside>

{ /* MOBILE - SAME AS NON-HOME-PAGE NAV */ }
<header class="md:hidden sticky top-0 z-50 bg-surface-1 p-3">
  <div class="mx-auto flex max-w-6xl items-center justify-between">
    <div class="flex items-end justify-center">
      <img class="-mb-0.5 h-auto w-8" src="/tricolor-paw.svg" alt="paw-logo">
      <a href="/" class="ml-2 font-serif text-xl font-bold text-content-3 soft-transition hover:text-content-2 focus-outline-rounded">maya sheth</a>
    </div>

    <!-- Mobile header items -->
    <div class="flex items-center gap-3 md:hidden">
      <!-- Mobile search bar (always visible) -->
      <div class="group relative">
        <Icon name="mdi--magnify" class="absolute left-2 top-1/2 h-5 w-5 -translate-y-1/2 text-content-3 transition-colors group-has-[:focus]:text-content-2" />
        <input type="text" placeholder="search!" class="w-32 rounded border border-content-3 py-1.5 pl-9 pr-3 font-base text-sm font-light text-content-1 focus-border">
      </div>
      
      <button class="focus-outline-rounded" id="mobile-menu-toggle">
        <Icon name="mdi--menu" class="h-6 w-6 text-content-3 soft-transition hover:text-content-2" id="mobile-menu-icon" />
      </button>
    </div>
  </div>

  <!-- Mobile dropdown menu (compact, below header) -->
  <div id="mobile-menu" class="max-h-0 opacity-0 translate-y-3 overflow-hidden bg-surface-1 transition-all duration-600 ease-in-out md:hidden">    
    <nav class="w-full border-t-1 border-content-4 py-4">
      <ul class="grid grid-cols-3 gap-x-8 gap-y-4 text-center">
        {NAV_ITEMS.map(item => (
          <li class="space-y-2">
            <div class="font-header text-base font-semibold tracking-wide text-content-2">{item.label}</div>
            <ul class="space-y-1.5">
              {item.children.map(child => (
                <li>
                  <a href={child.href} class={mobileClasses}>{child.label}</a>
                </li>
              ))}
            </ul>
          </li>
        ))}
      </ul>
    </nav>
  </div>
</header>

<script>
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuIcon = document.getElementById('mobile-menu-icon');

  mobileMenuToggle?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('max-h-0');
    mobileMenu?.classList.toggle('max-h-[1000px]'); // Adjust this value based on your menu's maximum height
    mobileMenu?.classList.toggle('opacity-0');
    mobileMenu?.classList.toggle('opacity-100');
    
    // Change icon between menu and close
    const isOpen = mobileMenu?.classList.contains('max-h-[1000px]');
    if (mobileMenuIcon) {
      mobileMenuIcon.setAttribute('name', isOpen ? 'mdi--close' : 'mdi--menu');
    }
  });

  // Close mobile menu when screen size changes to desktop
  window.addEventListener('resize', () => {
    if (window.innerWidth >= 768) {
      mobileMenu?.classList.add('max-h-0', 'opacity-0');
      mobileMenu?.classList.remove('max-h-[1000px]', 'opacity-100');
      if (mobileMenuIcon) {
        mobileMenuIcon.setAttribute('name', 'mdi--menu');
      }
    }
  });
</script>